# Implementation Plan: Comprehensive Test Suite for Analytics Application

**Branch**: `020-comprehensive-test-suite` | **Date**: 2026-01-05 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/020-comprehensive-test-suite/spec.md`

## Summary

Implement comprehensive test suite for Letterboxd Stats Client using Vitest, achieving 80%+ code coverage with emphasis on critical data processing paths (CSV parsing, merging, calculations) at 95%+ coverage. Tests will cover unit tests for business logic, integration tests for data flows, component tests for UI, and E2E tests for critical user journeys. Strategy: fix 14 existing failing tests first, then implement missing test coverage for gaps in business logic and component rendering.

## Technical Context

**Language/Version**: TypeScript 5, React 19, Next.js 16
**Primary Dependencies**: Vitest 1.2, @testing-library/react 16.3, Papa Parse 5.5, Zustand 5.0, Playwright 1.56
**Storage**: localStorage (client-side persistence, no backend APIs)
**Testing**: Vitest with jsdom environment, @testing-library/react for components, Playwright for E2E
**Target Platform**: Web browser (Chrome, Firefox, Safari) - responsive mobile/tablet/desktop
**Project Type**: Single Next.js web application with client-side data processing
**Performance Goals**: Tests execute under 3 seconds (unit/integration), upload 5 CSV files and display analytics in <5 seconds
**Constraints**: No external API calls, heavy mocking for isolation, 80%+ coverage goal (95%+ critical paths)
**Scale/Scope**: 175+ existing tests, 14 failing, adding comprehensive coverage for CSV, data merging, analytics, state management, components

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

✅ **Test-Driven Development (PASS)**: This feature is purely test-driven. Tests are the deliverable.
✅ **Browser-First, Client-Side Data (PASS)**: All tests mock localStorage, no API calls, no backend dependencies.
✅ **Modular, Testable Components (PASS)**: Tests will verify components are independently testable with injected dependencies.
✅ **CSV as Data Foundation (PASS)**: Tests verify CSV parsing, validation, and merging with Papa Parse.
✅ **Quality Standards (PASS)**: Tests themselves are the quality gates - coverage targets, responsive testing, error state handling.
**Gate Status**: ✅ PASS - Feature aligns with all constitutional principles.

## Project Structure

### Documentation (this feature)

```text
specs/020-comprehensive-test-suite/
├── plan.md              # This file (implementation planning document)
├── research.md          # Phase 0: Research findings and best practices
├── data-model.md        # Phase 1: Test data structures and fixtures
├── quickstart.md        # Phase 1: Quick start guide for test implementation
├── contracts/           # Phase 1: Test contract specifications
├── checklists/
│   └── requirements.md  # Specification quality validation
└── tasks.md             # Phase 2: Actionable test implementation tasks (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
__tests__/
├── unit/                # Unit tests for business logic
│   ├── csv-parser.test.ts
│   ├── data-merger.test.ts
│   ├── analytics-engine.test.ts
│   ├── profile-parser.test.ts
│   ├── profile-merger.test.ts
│   └── analytics-store.test.ts
├── integration/         # Integration tests for data flows
│   ├── csv-to-analytics.test.ts
│   └── profile-feature.test.tsx
├── e2e/                 # E2E tests for critical user journeys (Playwright)
│   ├── upload-csv.spec.ts
│   ├── merge-csvs.spec.ts
│   └── analytics-dashboard.spec.ts
├── fixtures/            # Mock data and test fixtures
│   ├── mock-csvs.ts
│   └── sample-data/
└── setup.ts             # Vitest setup with mocks (jsdom, window APIs, etc.)

lib/                     # Business logic (data transformation, parsing, calculations)
├── csv-parser.ts        # CSV parsing with Papa Parse
├── data-merger.ts       # Data merging and aggregation
├── analytics-engine.ts  # Analytics calculations
├── profile-parser.ts    # Profile CSV parsing
├── profile-merger.ts    # Profile data merging
└── types.ts             # TypeScript type definitions

hooks/                   # React hooks
└── use-analytics-store.ts  # Zustand store integration

components/             # React components (already tested)
├── StatsOverview.tsx
├── AnalyticsDashboard.tsx
└── [other components]

vitest.config.ts        # Vitest configuration
vitest.setup.ts         # Vitest setup (mocks, globals, cleanup)
```

**Structure Decision**: Single Next.js web application with established test structure. Tests organized by type (unit/integration/e2e) with fixtures separated for reusability. No backend, all client-side data processing. Existing test patterns maintained to ensure consistency.

## Complexity Tracking

No constitutional violations. Feature scope is contained: comprehensive testing of existing application logic without architectural changes. Testing strategy (unit/integration/E2E) follows industry standard practices.
